<app-user-submenu></app-user-submenu>

<!-- LATEST TRANSACTIONS -->
<div class="container mt-0 qlc-content-first qlc-content-home qlc-after-submenu">
  <div class="row">
    <div class="col-12 pl-0 pr-0 pb-2 pl-md-0 pr-md-0 pl-2 pr-2">
      <!-- LATEST TRANSACTIONS -->
      <div class="container">
        <div class="row">
          <!-- TITLE -->
          <div class="col-md-6 col-12 mt-2 pl-2 pr-2">
            <div class="content-title">
              <h1 class="chainx">ChainX Account Details - {{ chainxAccountService.getNetwork() }}</h1>
            </div>
          </div>
          <div class="col-md-3 col-12 pl-md-2 pr-md-2 pl-2 pr-2">
            <button type="submit" class="btn btn-primary content-header float-right w-100 pl-0 pr-0 chainx-background-light" routerLink="/staking/chainx">
              Staking
            </button>
          </div>
          <div class="col-md-3 col-12 pl-2 pr-2 pt-md-0 pt-2">
            <button type="submit" class="btn btn-primary content-header float-right w-100 pl-0 pr-0 chainx-background-light" routerLink="/wallets">
              Back to my Wallets
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="container pb-2">
  <div class="row pl-md-0 pr-md-0 pl-2 pr-2">
    <!-- LEFT -->
    <div class="col-lg-9 col-md-12 col-sm-12 order-lg-1 order-2 pl-0 pr-0 mb-3">
      <div class="container">
        <div class="row">
          <div class="col-12 pb-2 pl-2 pr-2">
            <div class="content-box-blue h-auto pb-3 chainx-background-light">
              <div class="container">
                <div class="row qlc-table-header-blue chainx-background-light">
                  <div class="col-12 white">Address</div>
                </div>
                <div class="row qlc-table-row-blue row-text-mid mt-3 chainx-background-light">
                  <div class="col-12 text-break pr-3"><span *ngIf="account.addressBookName" class="force-wrap">{{ account.addressBookName }} - </span>{{ account.id }} <a ngxClipboard [cbContent]="account.id"><img src="assets/img/icons/copy.svg" class="img-copy" data-toggle="tooltip" data-placement="top" title="Copy to clipboard"></a></div>
                  <div class="col-12 px-0" *ngIf="showEditName">
                    <div class="editNameButtons">
                      <div class="row pl-3 pr-3">
                        <div class="col-md-12 col-12 py-3">
                          <input type="text" class="form-control" [(ngModel)]="account.addressBookName" autofocus/>
                        </div>
                        <div class="col-md-4 col-12 ">
                          <button class="btn btn-primary chainx-background" type="button" (click)="editNameCancel()">
                            {{ 'CANCEL' | translate }}
                          </button>
                        </div>
                        <div class="col-md-4 col-12 py-3 py-md-0 ">
                          <button class="btn btn-primary chainx-background" type="button" (click)="editNameSave()">
                            {{ 'OK' | translate }}
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <!-- BALANCE QLC -->
          <div class="col-md-4 col-sm-6 col-12 pl-2 pr-2">
            <div class="content-box-white h-auto mt-2 pb-2">
              <div class="container">
                <div class="row qlc-table-header-white">
                  <div class="col-12">PCX Free Balance</div>
                </div>
              </div>
              <div class="container">
                <div class="row">
                  <div class="col-3 mt-3">
                    <img src="assets/img/token-pcx.png" class="w-100 icon-token">
                  </div>
                  <div class="col-9 pr-0 pl-0">
                    <div class="row qlc-table-row-white row-text-mid mt-3 pb-0">
                      <ng-container *ngIf="!loading; else showLoadingTemplate">
                        <div class="col-12 pb-0" *ngIf="account.balances != null; else nanTemplate">{{ (account.balances.Free / chainxAccountService.divisor) | currency:'':'':'1.2-8' }}</div>
                      </ng-container>
                    </div>
                    <div class="row qlc-table-row-white sub-page pt-0">
                      <div class="col-12 text-wrap pt-0"><span class="text-blue">-</span></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- BALANCE QSMS -->
          <div class="col-md-4 col-sm-6 col-12 pl-2 pr-2">
            <div class="content-box-white h-auto mt-2 pb-2">
              <div class="container">
                <div class="row qlc-table-header-white">
                  <div class="col-12">PCX Total Balance</div>
                </div>
              </div>
              <div class="container">
                <div class="row">
                  <div class="col-3 mt-3">
                    <img src="assets/img/token-pcx.png" class="w-100 icon-token">
                  </div>
                  <div class="col-9 pr-0 pl-0">
                    <div class="row qlc-table-row-white row-text-mid mt-3 pb-0">
                      <ng-container *ngIf="!loading; else showLoadingTemplate">
                        <div class="col-12 pb-0" *ngIf="account.balances != null; else nanTemplate">{{ (account.balances.TotalBalance / chainxAccountService.divisor) | currency:'':'':'1.2-8' }}</div>
                      </ng-container>
                    </div>
                    <div class="row qlc-table-row-white sub-page pt-0">
                      <div class="col-12 text-wrap pt-0"><span class="text-blue">-</span></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- BALANCE QGAS -->
          <div class="col-md-4 col-sm-6 col-12 pl-2 pr-2">
            <div class="content-box-white h-auto mt-2 pb-2">
              <div class="container">
                <div class="row qlc-table-header-white">
                  <div class="col-12">PCX Staking Reserved</div>
                </div>
              </div>
              <div class="container">
                <div class="row">
                  <div class="col-3 mt-3">
                    <img src="assets/img/token-pcx-staking.png" class="w-100 icon-token">
                  </div>
                  <div class="col-9 pr-0 pl-0">
                    <div class="row qlc-table-row-white row-text-mid mt-3 pb-0">
                      <ng-container *ngIf="!loading; else showLoadingTemplate">
                        <div class="col-12 pb-0" *ngIf="account.balances != null; else nanTemplate">{{ (account.balances.ReservedStaking / chainxAccountService.divisor) | currency:'':'':'1.2-8' }}</div>
                      </ng-container>
                    </div>
                    <div class="row qlc-table-row-white sub-page pt-0">
                      <div class="col-12 text-wrap pt-0"><span class="text-blue">-</span></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="container pt-0">
                <div class="row qlc-table-header-white pt-0">
                  <div class="col-12">PCX Unfreeze Reserved</div>
                </div>
              </div>
              <div class="container">
                <div class="row">
                  <div class="col-3 mt-3">
                    <img src="assets/img/token-pcx-unfreeze.png" class="w-100 icon-token">
                  </div>
                  <div class="col-9 pr-0 pl-0">
                    <div class="row qlc-table-row-white row-text-mid mt-3 pb-0">
                      <ng-container *ngIf="!loading; else showLoadingTemplate">
                        <div class="col-12 pb-0" *ngIf="account.balances != null; else nanTemplate">{{ (account.balances.ReservedStakingRevocation / chainxAccountService.divisor) | currency:'':'':'1.2-8' }}</div>
                      </ng-container>
                    </div>
                    <div class="row qlc-table-row-white sub-page pt-0">
                      <div class="col-12 text-wrap pt-0"><span class="text-blue">-</span></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="container mt-3">
              <div class="row">
                <div class="col-12 pl-0 pr-0">
                  <button type="submit" class="btn btn-primary btn-green btn-icon-chainx w-100 pl-2 pr-0 chainx-background-light" routerLink="/staking/chainx">CLAIM PCX Reward</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--     RIGHT -->
    <div class="col-lg-3 col-md-12 col-sm-12 order-lg-2 order-1 pl-0 pr-0 mb-xs-3 mb-3">
      <div class="col-12 pl-2 pr-2">
        <div class="content-box-chainx h-100 pb-4 pr-0 chainx-background">
          <div class="container">
            <div class="row qlc-table-header-blue chainx-background">
              <div class="col-12 white">Account Actions</div>
            </div>
            <div class="row pt-3 pr-0">
              <div class="col-12 pr-0">
                <a routerLink="/wallets/chainx/send/{{ account.id }}" class="menu-myaccount menu-icon-send pr-0">Send</a> <a (click)="editName()" class="menu-myaccount menu-icon-rename pr-0">Rename Account</a> <a *ngIf="account.id !== ''" href="{{ chainxAccountService.getExplorer() }}/accounts/{{ chainxAccountService.getPublicKey(account.id) }}" class="menu-myaccount menu-icon-details pr-0" target="_blank">Account Details</a> <a (click)="deleteWallet()" class="menu-myaccount menu-icon-delete pr-0" target="_blank">Delete wallet</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 pl-2 pr-2 mt-2">
        <div class="content-box-chainx pb-2 pr-0 chainx-background">
          <div class="container">
            <div class="row pt-3 pr-0">
              <div class="col-12 pr-0">
                <a (click)="recoverPrivateKey(recoverPrivateKeyTemplate)" class="menu-myaccount menu-icon-recoverkey pr-0" target="_blank">{{ recoverPrivateKeyText }}</a> <a *ngIf="account.mnemonic" (click)="recoverMnemonic(recoverMnemonicTemplate)" class="menu-myaccount menu-icon-recoverkey pr-0" target="_blank">{{ recoverMnemonicText }}</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!--LATEST TRANSACTIONS-->
<div class="container mt-0 mb-3">
  <div class="row">
    <div class="col-12 pl-0 pr-0">
      <!-- TITLE -->
      <div class="col-lg-12 mb-3 mt-2 pl-md-2 pr-md-2">
        <div class="content-title">
          <h1>Latest Asset Transfers</h1>
        </div>
      </div>
      <!-- LIST -->
      <div class="col-lg-12 mb-4 pl-md-2 pr-md-2" *ngIf="transfers; else showLoaderTemplate">
        <div class="content-box-white">
          <div class="container">
            <div class="row qlc-table-header">
              <div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-2 pl-4 pb-0">Type</div>
              <div class="col-xl-6 col-lg-5 col-md-5 col-sm-5 col-7 text-truncate">Address / Transaction ID</div>
              <div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-3 pr-sm-0 pr-4 text-right">Amount</div>
              <div class="col-xl-2 col-lg-3 col-md-3 col-sm-3 d-none d-sm-block col-6 pr-4 text-right">Time</div>
            </div>
            <div class="row qlc-table-row qlc-table-row-twolines closed" *ngFor="let transfer of transfers.items">
              <div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-2 pl-4 pb-0">
                <span class="qlc-icon icon-{{ transfer.signed === publicKey ? 'Send' : 'Receive' }}" [title]="transfer.signed === publicKey ? 'Send' : 'Receive'"></span> <span class="d-none d-sm-none d-md-inline-block txState">
                  <span class="text-color-lightgrey">State</span><br>
                  <span class="text-bold-grey" [innerText]="transfer.signed === publicKey ? 'Send' : 'Receive'"></span>
                </span>
              </div>
              <div class="col-xl-6 col-lg-5 col-md-5 col-sm-5 col-7 pb-0 text-truncate">
                <span class="text-color-lightgrey">{{transfer.signed === publicKey ? 'to' : 'from'}}: </span> <a href="{{ chainxAccountService.getExplorer() }}/accounts/{{'0x'+transfer.payee}}" target="_blank">{{ chainxAccountService.getPublicAddress('0x'+transfer.payee) }}</a> <a href="{{ chainxAccountService.getExplorer() }}/txs/{{transfer.hash}}" target="_blank"><br> <span class="text-tiny">{{ transfer.hash }}</span> </a>
              </div>
              <div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-3 pb-0 pr-sm-0 pr-4 text-right ">
                <span data-toggle="tooltip" data-placement="top" title="">{{ transfer.signed === publicKey ? '-' : '+'}} {{ (transfer.value / chainxAccountService.divisor) | currency:'':'':'1.2-8' }}</span> <br><span class="text-color-grey">{{ transfer.token }}</span>
              </div>
              <div class="col-xl-2 col-lg-3 col-md-3 col-sm-3 col-12 pr-4 text-right">
                {{ transfer.time | date: 'short' }}
              </div>
              <div class="container transaction-details">
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--       BUTTON-->
      <ng-container *ngIf="transactions">
        <div class="col-lg-12 mb-0 mt-2 pl-md-2 pr-md-2 text-center" *ngIf="transactions.total>transactions.pageSize">
          <a (click)="getTransactions(transactions.total)" class="btn btn-primary btn-blue">ALL TRANSACTIONS</a>
        </div>
      </ng-container>
    </div>
  </div>
</div>
<!--LATEST TRANSACTIONS-->
<div class="container mt-0 mb-3">
  <div class="row">
    <div class="col-12 pl-0 pr-0">
      <!-- TITLE -->
      <div class="col-lg-12 mb-3 mt-2 pl-md-2 pr-md-2">
        <div class="content-title">
          <h1>Latest Staking Records</h1>
        </div>
      </div>
      <!-- LIST -->
      <div class="col-lg-12 mb-4 pl-md-2 pr-md-2" *ngIf="transactions; else showLoaderTemplate">
        <div class="content-box-white">
          <div class="container">
            <div class="row qlc-table-header">
              <div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-2 pl-4 pb-0">Type</div>
              <div class="col-xl-6 col-lg-5 col-md-5 col-sm-5 col-7 text-truncate">Address / Transaction ID</div>
              <div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-3 pr-sm-0 pr-4 text-right">Amount</div>
              <div class="col-xl-2 col-lg-3 col-md-3 col-sm-3 d-none d-sm-block col-6 pr-4 text-right">Time</div>
            </div>
            <ng-container *ngFor="let transaction of transactions.items">
              <div class="row qlc-table-row qlc-table-row-twolines closed" *ngIf="transaction.call !== 'transfer'">
                <div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-2 pl-4 pb-0">
                  <span class="qlc-icon icon-chainx-{{ transaction.call === 'nominate' ? 'invoke' : (transaction.call === 'unnominate' ? 'revoke' : transaction.call) }}" title="{{ transaction.call }}"></span> <span class="d-none d-sm-none d-md-inline-block txState">
                      <span class="text-color-lightgrey">State</span><br>
                      <span class="text-bold-grey text-capitalize">{{ transaction.call === 'nominate' ? 'invoke' : (transaction.call === 'unnominate' ? 'revoke' : transaction.call) }}</span>
                    </span>
                </div>
                <div class="col-xl-6 col-lg-5 col-md-5 col-sm-5 col-7 pb-0 text-truncate">
                  <span class="text-color-lightgrey">Target: </span> <a href="{{ chainxAccountService.getExplorer() }}/accounts/{{'0x'+transaction.args[0].data}}" target="_blank">{{ chainxAccountService.getPublicAddress('0x'+transaction.args[0].data) }}</a> <a href="{{ chainxAccountService.getExplorer() }}/txs/{{transaction.hash}}" target="_blank"><br> <span class="text-tiny">{{ transaction.hash }}</span> </a>
                </div>
                <div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-3 pb-0 pr-sm-0 pr-4 text-right" *ngIf="transaction.call === 'nominate' || transaction.call === 'unnominate'; else noBalanceTemplate">
                  <span data-toggle="tooltip" data-placement="top" title="-"> {{ (transaction.args[1].data / chainxAccountService.divisor) | currency:'':'':'1.2-8' }}<br><span class="text-color-grey">PCX</span></span>
                </div>
                <div class="col-xl-2 col-lg-3 col-md-3 col-sm-3 col-12 pr-4 text-right">
                  {{ transaction.time | date: 'short' }}
                </div>
                <div class="container transaction-details">
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
      <!--       BUTTON-->
      <ng-container *ngIf="transactions">
        <div class="col-lg-12 mb-0 mt-2 pl-md-2 pr-md-2 text-center" *ngIf="transactions.total>transactions.pageSize">
          <a (click)="getTransactions(transactions.total)" class="btn btn-primary btn-blue">ALL TRANSACTIONS</a>
        </div>
      </ng-container>
    </div>
  </div>
</div>
<ng-template #nanTemplate>
  <div class="col-12 pb-0">NaN</div>
</ng-template>
<ng-template #noBalanceTemplate>
  <div class="col-xl-2 col-lg-2 col-md-2 col-sm-2 col-3 pb-0 pr-sm-0 pr-4 text-right ">
    <span data-toggle="tooltip" data-placement="top" title="-">/<br><span class="text-color-grey">PCX</span></span>
  </div>
</ng-template>
<ng-template #showLoadingTemplate>
  <div class="col-12 pb-0">
    <img src="assets/img/preloaders/preloader-black-38px.svg" style="margin-top:-2px;width:24px;height:auto;opacity:0.65;">
  </div>
</ng-template>
<ng-template #showLoaderTemplate>
  <img src="assets/img/preloaders/preloader-chainx-64px.svg" style="margin-left: calc(50% - 32px); margin-top: 10%;">
</ng-template>
<ng-template #recoverPrivateKeyTemplate>
  <div class="modal-body">
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
    <div class="row text-center">
      <div class="col-12">
        <h1 class="pt-5">Your ChainX private key is</h1>
        <p class="pb-5" class="overflow-wrap">{{ recoveredPrivateKey }}</p>
      </div>
    </div>
  </div>
</ng-template>
<ng-template #recoverMnemonicTemplate>
  <div class="modal-body">
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
    <div class="row text-center">
      <div class="col-12">
        <h1 class="pt-5">Your ChainX mnemonic phrase is</h1>
        <p class="pb-5" class="overflow-wrap">{{ recoveredMnemonic }}</p>
      </div>
    </div>
  </div>
</ng-template>
